generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username String   @unique
  password String
  email    String   @unique
  role     userType @default(STUDENT)
  student  Student?
  faculty  Faculty?
  admin    Admin?
}

model Student {
  id               String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rollNo           String                      @unique
  fullName         String
  semesterId       String                      @db.Uuid
  semester         Semester                    @relation(fields: [semesterId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  branchId         String                      @db.Uuid
  branch           Branch                      @relation(fields: [branchId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  mobileNo         String
  email            String
  user             User                        @relation(fields: [userId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  userId           String                      @unique @db.Uuid
  courseRegistered CourseRegistration[]
  attendances      Attendance[]
  examEntries      MarksEntry[]
}

model Faculty {
  id             String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fullName       String
  department     departmentType
  email          String
  user           User                      @relation(fields: [userId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  userId         String                    @unique @db.Uuid
  courseAssigned FacultyCourseAssignment[]
}

model Admin {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fullName String
  email    String
  user     User   @relation(fields: [userId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  userId   String @unique @db.Uuid
}

model Semester {
  id     String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sem    Int      @unique
  name   String   @unique
  course Course[]
  student Student[]
}

model Branch {
  id     String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name   String   @unique
  code   String   @unique
  course Course[]
  student Student[]
}

model Course {
  id                String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code         String                      @unique
  name              String
  courseType    courseType
  electiveCode  String?
  credit      Int
  labIncluded   Boolean     @default(false)
  batchId     String    @db.Uuid
  batch     Batch   @relation(fields: [batchId],references: [id], onDelete: NoAction, onUpdate: NoAction)
  branch    Branch[]
  semester  Semester[]
  studentRegistered CourseRegistration[]
  facultyAssigned   FacultyCourseAssignment[]
  attendances       Attendance[]
  examEntries       MarksEntry[]
}

model CourseRegistration {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId  String  @db.Uuid
  studentId String  @db.Uuid
  course    Course  @relation(fields: [courseId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  student   Student @relation(fields: [studentId], references: [id],onDelete: NoAction, onUpdate: NoAction)
}

model FacultyCourseAssignment {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  facultyId String  @db.Uuid
  courseId  String  @db.Uuid
  @@unique([facultyId, courseId])
  faculty   Faculty @relation(fields: [facultyId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  course    Course  @relation(fields: [courseId], references: [id],onDelete: NoAction, onUpdate: NoAction)
}

model MarksEntry {
  id            String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  examCode    examCode
  examType    examType
  courseId      String  @db.Uuid
  studentId     String  @db.Uuid
  marksObtained Float
  remarks       String?
  @@unique([examCode,examType,courseId,studentId])
  course        Course  @relation(fields: [courseId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  student       Student @relation(fields: [studentId], references: [id],onDelete: NoAction, onUpdate: NoAction)
}

model Attendance {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId  String   @db.Uuid
  studentId String   @db.Uuid
  date      DateTime @default(now())
  isPresent Boolean
  @@unique([courseId,studentId,date])
  classType classType   @default(REGULAR)
  attendanceType attenanceType  @default(THEORY)
  student   Student  @relation(fields: [studentId], references: [id],onDelete: NoAction, onUpdate: NoAction)
  course    Course   @relation(fields: [courseId], references: [id],onDelete: NoAction, onUpdate: NoAction)
}

enum userType {
  STUDENT
  FACULTY
  ADMIN
}

enum departmentType {
  ELECTRONICS
  COMPUTING
}


enum examCode {
  CT1
  CT2
  ENDSEM
}

enum examType{
 LAB 
 THEORY
}

enum courseType{
  GIR 
  PC
  PE 
  SE
}

enum classType{
  EXTRA
  REGULAR
}

enum attenanceType{
  THEORY
  LAB
}

model Batch{
  id String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code  String  @unique
  name String
  course Course[]
}

model SteamElective{
  id String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code  String  @unique
  name String
}

model ProgramElective{
  id String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code  String  @unique
  name String
}